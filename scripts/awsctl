#!/usr/bin/env sh
set -e

# Ensure Docker is installed
if ! command -v docker >/dev/null 2>&1; then
  echo "Error: Docker is not installed or not in PATH. Please install Docker to use awsctl." >&2
  exit 1
fi

# Ensure Docker daemon is running
if ! docker info >/dev/null 2>&1; then
  echo "Error: Docker daemon is not running. Please start Docker to use awsctl." >&2
  exit 1
fi

WORKDIR="$(pwd)"
HOME_DIR="${HOME:-/root}"

# Set docker flags. Only add -it if we're in an interactive terminal
DOCKER_FLAGS="--rm"
if [ -t 0 ]; then
  DOCKER_FLAGS="$DOCKER_FLAGS -it"
fi

# If _AWSCTL_COMPLETE is set, pass it to the container
if [ -n "$_AWSCTL_COMPLETE" ]; then
  DOCKER_FLAGS="$DOCKER_FLAGS -e _AWSCTL_COMPLETE=1"
fi

exec docker run $DOCKER_FLAGS \
  -v "$WORKDIR:/work" -w /work \
  -v "$HOME_DIR:/root" \
  --entrypoint awsctl \
  awsctl:latest "$@"
